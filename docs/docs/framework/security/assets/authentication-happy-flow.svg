<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1151.828739368978" height="901.049814028"><desc>participant%20Browser%0A%0Aparticipantgroup%20%23ffefdf%20%3A0%20**Invirt**%0Aparticipant%20%22Authentication%5CnFilter%22%20as%20AuthenticationFilter%0Aparticipant%20%22Principal%5CnThreadLocal%22%20as%20PrincipalThreadLocal%0Aend%0A%0Aparticipantgroup%20%23F0F0FF%20%3A0%20**Application**%0Aparticipant%20Authenticator%0Aparticipant%20%22%2Fsome%2Fpage%5CnHandler%22%20as%20pageHandler%0Aend%0A%0Alifelinestyle%20%23A0A0A0%3A1%3Asolid%0A%0A%0ABrowser%20-%3E%20AuthenticationFilter%3A%20GET%20%2Fsome%2Fpage%0Aactivate%20AuthenticationFilter%0A%0AAuthenticationFilter%20-%3E%20Authenticator%3A%20Authenticator.authenticate(request)%0Aactivate%20Authenticator%0AAuthenticator%20-%3E%20Authenticator%3A%201.%20Read%20cookies%2Ftokens%5Cn2.%20Validate%20tokens%5Cn3.%20Create%20Principal%20object%0A%0AAuthenticator%20-%3E%20AuthenticationFilter%3A%20AuthenticationResponse.Authenticated(principal)%0Adeactivate%20Authenticator%0A%0AAuthenticationFilter%20-%3E%20PrincipalThreadLocal%3A%20Store%20Principal%5Cnon%20current%20thread%0AAuthenticationFilter%20-%3E%20AuthenticationFilter%3A%20Store%20Principal%5Cnon%20current%20request%0AAuthenticationFilter%20-%3E%20pageHandler%3A%20Proceed%20with%20request%0Aactivate%20pageHandler%0ApageHandler%20-%3E%20PrincipalThreadLocal%3A%20Get%20current%20principal%0APrincipalThreadLocal%20-%3E%20pageHandler%3A%20Return%20current%20principal%0ApageHandler%20-%3E%20pageHandler%3A%20Check%20principal%20permissions%5Cn(authorisation)%2C%20render%20page%0ApageHandler%20-%3E%20AuthenticationFilter%3A%20Response%5Cn(HTTP%20OK)%0Adeactivate%20pageHandler%0AAuthenticationFilter%20-%3E%20Browser%3A%20Response%5Cn(HTTP%20OK)%0Adeactivate%20AuthenticationFilter</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="1151" height="909"/></g><g><g><path fill="#ffefdf" stroke="none" paint-order="stroke fill markers" d=" M 206.8351744773587 9.556093930499998 L 533.7489798203086 9.556093930499998 L 533.7489798203086 901.049814028 L 206.8351744773587 901.049814028 L 206.8351744773587 9.556093930499998 Z"/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="bold" text-decoration="normal" x="352.4087439426569" y="32.4253785505" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Invirt</text></g><g><path fill="#F0F0FF" stroke="none" paint-order="stroke fill markers" d=" M 644.7046269352837 9.556093930499998 L 987.5536292839832 9.556093930499998 L 987.5536292839832 901.049814028 L 644.7046269352837 901.049814028 L 644.7046269352837 9.556093930499998 Z"/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="bold" text-decoration="normal" x="776.3124624602194" y="32.4253785505" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Application</text></g></g><g><path fill="none" stroke="#A0A0A0" paint-order="fill stroke markers" d=" M 52.7079647872627 108.792453978 L 52.7079647872627 901.049814028" stroke-miterlimit="10" stroke-width="1.3612669416666667"/><path fill="none" stroke="#A0A0A0" paint-order="fill stroke markers" d=" M 279.0931365943333 108.792453978 L 279.0931365943333 901.049814028" stroke-miterlimit="10" stroke-width="1.3612669416666667"/><path fill="none" stroke="#A0A0A0" paint-order="fill stroke markers" d=" M 467.20768106392967 108.792453978 L 467.20768106392967 901.049814028" stroke-miterlimit="10" stroke-width="1.3612669416666667"/><path fill="none" stroke="#A0A0A0" paint-order="fill stroke markers" d=" M 713.6959226399049 108.792453978 L 713.6959226399049 901.049814028" stroke-miterlimit="10" stroke-width="1.3612669416666667"/><path fill="none" stroke="#A0A0A0" paint-order="fill stroke markers" d=" M 923.4456648781902 108.792453978 L 923.4456648781902 901.049814028" stroke-miterlimit="10" stroke-width="1.3612669416666667"/></g><g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 8.167601650000002 64.687405068 L 97.2483279245254 64.687405068 L 97.2483279245254 108.792453978 L 8.167601650000002 108.792453978 L 8.167601650000002 64.687405068 Z" stroke-miterlimit="10" stroke-width="2.613632528" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="25.891297230500008" y="92.457250678" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Browser</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 215.0027761273587 48.515553801 L 343.1834970613079 48.515553801 L 343.1834970613079 108.792453978 L 215.0027761273587 108.792453978 L 215.0027761273587 48.515553801 Z" stroke-miterlimit="10" stroke-width="2.613632528" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="232.7264717078587" y="76.12204737799999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Authentication</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="262.8264701819798" y="92.457250678" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Filter</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 408.83398395755074 48.515553801 L 525.5813781703085 48.515553801 L 525.5813781703085 108.792453978 L 408.83398395755074 108.792453978 L 408.83398395755074 48.515553801 Z" stroke-miterlimit="10" stroke-width="2.613632528" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="439.141013507167" y="76.12204737799999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Principal</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="426.55767953805076" y="92.457250678" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">ThreadLocal</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 652.8722285852838 64.687405068 L 774.519616694526 64.687405068 L 774.519616694526 108.792453978 L 652.8722285852838 108.792453978 L 652.8722285852838 64.687405068 Z" stroke-miterlimit="10" stroke-width="2.613632528" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="670.5959241657838" y="92.457250678" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Authenticator</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 867.5053021223972 48.515553801 L 979.3860276339832 48.515553801 L 979.3860276339832 108.792453978 L 867.5053021223972 108.792453978 L 867.5053021223972 48.515553801 Z" stroke-miterlimit="10" stroke-width="2.613632528" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="885.2289977028972" y="76.12204737799999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">/some/page</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="897.828998084367" y="92.457250678" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Handler</text></g></g><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 270.9255349443333 162.698624868 L 287.2607382443333 162.698624868 L 287.2607382443333 843.876602478 L 270.9255349443333 843.876602478 L 270.9255349443333 162.698624868" stroke-miterlimit="10" stroke-width="1.3612669416666667" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 705.5283209899048 208.437194108 L 721.863524289905 208.437194108 L 721.863524289905 353.82050347800003 L 705.5283209899048 353.82050347800003 L 705.5283209899048 208.437194108" stroke-miterlimit="10" stroke-width="1.3612669416666667" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 915.2780632281901 544.942382088 L 931.6132665281903 544.942382088 L 931.6132665281903 781.802829938 L 915.2780632281901 781.802829938 L 915.2780632281901 544.942382088" stroke-miterlimit="10" stroke-width="1.3612669416666667" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="106.53341608741667" y="156.16454354799998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">GET /some/page</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 52.7079647872627 162.698624868 L 257.47621756066667 162.698624868" stroke-miterlimit="10" stroke-width="1.3612669416666667" stroke-dasharray=""/><g transform="translate(270.9255349443333,162.698624868) translate(-270.9255349443333,-162.698624868)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 257.31286552766664 155.89229015966666 L 270.9255349443333 162.698624868 L 257.31286552766664 169.50495957633333 Z"/></g></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="382.56119374065423" y="201.903112788" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Authenticator.authenticate(request)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 287.2607382443333 208.437194108 L 692.0790036062382 208.437194108" stroke-miterlimit="10" stroke-width="1.3612669416666667" stroke-dasharray=""/><g transform="translate(705.5283209899048,208.437194108) translate(-705.5283209899048,-208.437194108)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 691.9156515732382 201.63085939966666 L 705.5283209899048 208.437194108 L 691.9156515732382 215.24352881633334 Z"/></g></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="743.6437953565717" y="247.641682028" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. Read cookies/tokens</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="743.6437953565717" y="263.976885328" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. Validate tokens</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="743.6437953565717" y="280.31208862799997" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. Create Principal object</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 721.863524289905 286.846169948 L 787.2043374899049 286.846169948 L 787.2043374899049 308.08193423800003 L 735.3128416735716 308.08193423800003" stroke-miterlimit="10" stroke-width="1.3612669416666667" stroke-dasharray=""/><g transform="translate(721.863524289905,308.08193423800003) translate(-721.863524289905,-308.08193423800003)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 735.4761937065716 301.2755995296667 L 721.863524289905 308.08193423800003 L 735.4761937065716 314.88826894633337 Z"/></g></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="338.2278578641894" y="347.286422158" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">AuthenticationResponse.Authenticated(principal)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 705.5283209899048 353.82050347800003 L 300.71005562799996 353.82050347800003" stroke-miterlimit="10" stroke-width="1.3612669416666667" stroke-dasharray=""/><g transform="translate(287.2607382443333,353.82050347800003) translate(-287.2607382443333,-353.82050347800003)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 300.873407661 347.0141687696667 L 287.2607382443333 353.82050347800003 L 300.873407661 360.6268381863334 Z"/></g></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="321.5508772108942" y="393.024991398" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Store Principal</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="321.5508772108942" y="409.360194698" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">on current thread</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 287.2607382443333 415.894276018 L 453.758363680263 415.894276018" stroke-miterlimit="10" stroke-width="1.3612669416666667" stroke-dasharray=""/><g transform="translate(467.20768106392967,415.894276018) translate(-467.20768106392967,-415.894276018)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 453.595011647263 409.0879413096667 L 467.20768106392967 415.894276018 L 453.595011647263 422.70061072633337 Z"/></g></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="309.041009311" y="455.09876393800005" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Store Principal</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="309.041009311" y="471.43396723800004" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">on current request</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 287.2607382443333 477.968048558 L 352.6015514443333 477.968048558 L 352.6015514443333 499.20381284800004 L 300.71005562799996 499.20381284800004" stroke-miterlimit="10" stroke-width="1.3612669416666667" stroke-dasharray=""/><g transform="translate(287.2607382443333,499.20381284800004) translate(-287.2607382443333,-499.20381284800004)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 300.873407661 492.3974781396667 L 287.2607382443333 499.20381284800004 L 300.873407661 506.0101475563334 Z"/></g></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="532.5694009269967" y="538.408300768" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Proceed with request</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 287.2607382443333 544.942382088 L 901.8287458445235 544.942382088" stroke-miterlimit="10" stroke-width="1.3612669416666667" stroke-dasharray=""/><g transform="translate(915.2780632281901,544.942382088) translate(-915.2780632281901,-544.942382088)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 901.6653938115235 538.1360473796667 L 915.2780632281901 544.942382088 L 901.6653938115235 551.7487167963334 Z"/></g></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="625.3928727182645" y="584.146870008" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Get current principal</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 915.2780632281901 590.680951328 L 480.6569984475963 590.680951328" stroke-miterlimit="10" stroke-width="1.3612669416666667" stroke-dasharray=""/><g transform="translate(467.20768106392967,590.680951328) translate(-467.20768106392967,-590.680951328)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 480.82035048059635 583.8746166196667 L 467.20768106392967 590.680951328 L 480.82035048059635 597.4872860363333 Z"/></g></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="615.2262057337064" y="629.8854392479999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Return current principal</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 467.20768106392967 636.4195205679999 L 901.8287458445235 636.4195205679999" stroke-miterlimit="10" stroke-width="1.3612669416666667" stroke-dasharray=""/><g transform="translate(915.2780632281901,636.4195205679999) translate(-915.2780632281901,-636.4195205679999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 901.6653938115235 629.6131858596666 L 915.2780632281901 636.4195205679999 L 901.6653938115235 643.2258552763333 Z"/></g></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="953.393537594857" y="675.6240084879998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Check principal permissions</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="953.393537594857" y="691.9592117879998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(authorisation), render page</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 931.6132665281903 698.4932931079999 L 996.9540797281902 698.4932931079999 L 996.9540797281902 719.7290573979999 L 945.0625839118569 719.7290573979999" stroke-miterlimit="10" stroke-width="1.3612669416666667" stroke-dasharray=""/><g transform="translate(931.6132665281903,719.7290573979999) translate(-931.6132665281903,-719.7290573979999)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 945.2259359448569 712.9227226896666 L 931.6132665281903 719.7290573979999 L 945.2259359448569 726.5353921063332 Z"/></g></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="564.7027341331734" y="758.9335453179999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Response</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="564.7027341331734" y="775.2687486179999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(HTTP OK)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 915.2780632281901 781.802829938 L 300.71005562799996 781.802829938" stroke-miterlimit="10" stroke-width="1.3612669416666667" stroke-dasharray=""/><g transform="translate(287.2607382443333,781.802829938) translate(-287.2607382443333,-781.802829938)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 300.873407661 774.9964952296666 L 287.2607382443333 781.802829938 L 300.873407661 788.6091646463333 Z"/></g></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="125.25008326270964" y="821.007317858" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Response</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="125.25008326270964" y="837.342521158" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(HTTP OK)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 270.9255349443333 843.876602478 L 66.15728217092936 843.876602478" stroke-miterlimit="10" stroke-width="1.3612669416666667" stroke-dasharray=""/><g transform="translate(52.7079647872627,843.876602478) translate(-52.7079647872627,-843.876602478)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 66.32063420392937 837.0702677696667 L 52.7079647872627 843.876602478 L 66.32063420392937 850.6829371863333 Z"/></g></g></g><g/><g/></g></svg>